# GeekBrains Chat Bot Service

1. Entities (датаклассы)
    - EventCommandReceived
    - EventCommandToSend
    - клик на инлайн-кнопку
    - команда
2. Интерфейс адаптеров
3. Движок чат-бота и ИМ
    - модели каталога
        - Category
        - Product
        - Order
    - модели
        - BotUser
        - Chat
        - Message
    - код, который решает, что отправить
4. Константы из файла constants (нужные для моделей)
5. Интерфейс платежного модуля
    - модели
        - Банковская карта
        - Платеж (Payment)
    - интерфейс функций

## Развёртывание проекта и настройка окружения.

Скрипт `prepare.py` предназначен для автоматизации развёртывания Python проектов на базе Django,
настройки виртуального окружения для них и выполнения базовых миграций.

При запуске в директории с дистрибутивом - создаёт виртуальное окружение Python,
устанавливает туда пакеты в соответствии с требованиями проекта и инициирует базу данных.

Скрипт выполняет следующие шаги (для Linux вместо `pip` будет использоваться команда `pip3`):
1. Изначально выполняется `pip install virtualenv`
2. Если папка с виртуальным окружением существует - она удаляется
3. Запускается команда `virtualenv <директория для venv>` для установки виртуального окружения в соответствующую папку
(по умолчанию - `venv/`)
4. Выполняется переход в виртуальное окружение - аналог команды:
    - для Windows: `venv\Scripts\activate.bat`
    - для Linux: `source venv/bin/activate`
5. Запускается установка требований пакетов - `pip install -r requirements.txt`
6. Выполняются команды для базовых миграций/создания DB:
    - `python manage.py makemigrations`
    - `python manage.py migrate` 

## Задача

Сделать простейший чат-бот для продажи и оплаты товаров в Одноклассниках и чате на сайте.

**Пример диалога с ботом:**

```
- Здравствуйте
- Здравствуйте, Евгений! Выберите категорию товаров: ...
- <кликнул на кнопку>
- Выберите товар: ...
- <кликнул на кнопку>
- Оплатите товар по ссылке: ...
- <произвел оплату>
- Спасибо! Начать заново?
```

Задача делится на 3 группы работ:

### 1. Подключить каналы:

1. [JivoSite](docs/jivosite.md)
2. [Одноклассники](docs/ok.md)

### 2. Подключить платежные системы:

1. [Stripe](https://stripe.com/)
2. [PayPal](https://www.paypal.com/ru/home)
3. [Click.uz](http://click.uz/)
4. [Paymo.uz](https://paymo.uz/)

### 3. Реализовать бизнес-логику:

1. [Разработать простейший интерфейс для просмотра диалогов](docs/chat_interface.md)
2. Разрботать обработчики сообщений пользователя

## Архитектура

Чат-бот состоит из четырех частей:

1. Адаптеры к каналам
    - `EventCommandReceived`
    - `EventCommandToSend`
    - клик на инлайн-кнопку
    - команда
2. Движок магазина
3. Модуль платежных систем
4. Интерфейс чатов

**Как все работает:**

- Сообщения, поступающие в любой канал, преобразуются адаптером в универсальный формат `EventCommandReceived`
- Движок магазина обрабатывает входящее сообщение и выдает ответ универсальном формате `EventCommandToSend`
- Адаптер конкретного канала преобразует исходящее сообщение в запрос к АПИ ботов.

## Перед отправкой кода проверь:

Проверить чистоту кода с помощью линетров mypy и flake8.
Для проверки требуется запустить срипт run_linters.cmd.
По итогам проверки будет создана в проекте папка с именем report_linters с отчетами результатов проверки. 

